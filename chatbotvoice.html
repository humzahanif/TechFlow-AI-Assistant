<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow Calling Assistant</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding-top: 20px;
        }

        .custom-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header-title {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .call-status {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .status-active {
            background: linear-gradient(135deg, #198754, #157347);
            color: white;
            animation: pulse 2s infinite;
        }

        .status-inactive {
            background: linear-gradient(135deg, #dc3545, #b02a37);
            color: white;
        }

        .status-waiting {
            background: linear-gradient(135deg, #fd7e14, #e8590c);
            color: white;
        }

        .btn-gradient-success {
            background: linear-gradient(45deg, #198754, #157347);
            border: none;
            color: white;
        }

        .btn-gradient-danger {
            background: linear-gradient(45deg, #dc3545, #b02a37);
            border: none;
            color: white;
        }

        .btn-gradient-warning {
            background: linear-gradient(45deg, #fd7e14, #e8590c);
            border: none;
            color: white;
        }

        .btn-gradient-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
        }

        .btn-gradient-success:hover,
        .btn-gradient-danger:hover,
        .btn-gradient-warning:hover,
        .btn-gradient-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            color: white;
        }

        .voice-animation {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .voice-circle {
            width: 100%;
            height: 100%;
            border: 3px solid #667eea;
            border-radius: 50%;
            position: absolute;
            animation: voicePulse 1.5s infinite;
        }

        .voice-circle:nth-child(2) {
            animation-delay: 0.5s;
        }

        .voice-circle:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes voicePulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 40px rgba(102, 126, 234, 0.8);
            }
        }

        .typing-dots {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typingDots 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        @media (max-width: 768px) {
            .header-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="custom-container">
        <div class="card header-card rounded-4 text-center mb-4">
            <div class="card-body p-4">
                <h1 class="header-title mb-2">
                    <i class="bi bi-telephone-fill me-2"></i>TechFlow Calling Assistant
                </h1>
                <p class="lead">AI-Powered Customer Support & Sales Assistant</p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="card rounded-4 h-100">
                    <div class="card-body p-4">
                        <div class="call-status status-inactive rounded-4 mb-4" id="callStatus">
                            <i class="bi bi-telephone me-2"></i>WAITING FOR CALLS
                        </div>

                        <div class="d-flex justify-content-center gap-3 mb-4 flex-wrap">
                            <button class="btn btn-gradient-success rounded-pill px-4 py-2 fw-bold" id="startCallBtn" onclick="startCall()">
                                <i class="bi bi-telephone-plus me-2"></i>Start Call
                            </button>
                            <button class="btn btn-gradient-danger rounded-pill px-4 py-2 fw-bold" id="endCallBtn" onclick="endCall()" disabled>
                                <i class="bi bi-telephone-x me-2"></i>End Call
                            </button>
                            <button class="btn btn-gradient-warning rounded-pill px-4 py-2 fw-bold" id="muteBtn" onclick="toggleMute()">
                                <i class="bi bi-mic-mute me-2"></i>Mute
                            </button>
                        </div>

                        <div class="bg-light rounded-4 p-4 mb-4">
                            <h5 class="mb-3">
                                <i class="bi bi-mic me-2"></i>Voice Interface
                            </h5>
                            <div class="voice-animation mx-auto mb-3" id="voiceAnimation" style="display: none;">
                                <div class="voice-circle"></div>
                                <div class="voice-circle"></div>
                                <div class="voice-circle"></div>
                            </div>
                            
                            <div class="d-flex justify-content-center gap-3 mb-3">
                                <button class="btn btn-primary rounded-circle p-3" style="width: 80px; height: 80px;" id="listenBtn" onclick="startListening()" disabled>
                                    <i class="bi bi-mic-fill fs-3"></i>
                                </button>
                                <button class="btn btn-danger rounded-circle p-3" style="width: 80px; height: 80px;" id="speakBtn" onclick="speakResponse()" disabled>
                                    <i class="bi bi-volume-up-fill fs-3"></i>
                                </button>
                            </div>
                            
                            <div class="text-center" id="voiceStatus">
                                Voice recognition ready
                            </div>
                        </div>

                        <div class="border rounded-4 p-3 mb-4" style="max-height: 400px; overflow-y: auto;" id="conversationArea">
                            <div class="d-none" id="typingIndicator">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="typing-dots me-2">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                    <span class="text-muted">TechFlow Assistant is typing...</span>
                                </div>
                            </div>
                        </div>

                        <div class="input-group">
                            <input type="text" class="form-control rounded-start-pill border-end-0" id="textInput" placeholder="Type message for testing..." disabled>
                            <button class="btn btn-gradient-primary rounded-end-pill border-start-0" id="sendBtn" onclick="sendTextMessage()" disabled>
                                <i class="bi bi-send me-1"></i>Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card rounded-4 h-100">
                    <div class="card-body p-4">
                        <div class="bg-light rounded-4 p-3 mb-4">
                            <h5 class="mb-3">
                                <i class="bi bi-person me-2"></i>Caller Information
                            </h5>
                            <div class="mb-3">
                                <label for="callerName" class="form-label fw-semibold">Caller Name</label>
                                <input type="text" class="form-control" id="callerName" placeholder="Enter caller name">
                            </div>
                            <div class="mb-3">
                                <label for="callerPhone" class="form-label fw-semibold">Phone Number</label>
                                <input type="tel" class="form-control" id="callerPhone" placeholder="+92 300 1234567">
                            </div>
                            <div class="mb-3">
                                <label for="callerCompany" class="form-label fw-semibold">Company</label>
                                <input type="text" class="form-control" id="callerCompany" placeholder="Company name">
                            </div>
                            <div class="mb-0">
                                <label for="inquiryType" class="form-label fw-semibold">Inquiry Type</label>
                                <select class="form-select" id="inquiryType">
                                    <option value="">Select inquiry type</option>
                                    <option value="web-development">Web Development</option>
                                    <option value="cloud-solutions">Cloud Solutions</option>
                                    <option value="ai-integration">AI Integration</option>
                                    <option value="mobile-apps">Mobile Apps</option>
                                    <option value="cybersecurity">Cybersecurity</option>
                                    <option value="data-analytics">Data Analytics</option>
                                    <option value="pricing">Pricing Information</option>
                                    <option value="support">Technical Support</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <h5 class="mb-3">
                                <i class="bi bi-graph-up me-2"></i>Call Metrics
                            </h5>
                            <div class="bg-light rounded-4 p-3">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="fw-bold text-primary fs-5" id="callDuration">00:00:00</div>
                                        <small class="text-muted">Duration</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="fw-bold text-success fs-5" id="messageCount">0</div>
                                        <small class="text-muted">Messages</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="fw-bold text-info fs-5" id="callStatusText">Inactive</div>
                                        <small class="text-muted">Status</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card rounded-4">
            <div class="card-body p-4">
                <h3 class="mb-4">
                    <i class="bi bi-bar-chart me-2"></i>Call Analytics Dashboard
                </h3>
                
                <div class="row mb-4">
                    <div class="col-sm-6 col-lg-3 mb-3">
                        <div class="card bg-primary text-white rounded-4">
                            <div class="card-body text-center">
                                <div class="display-4 fw-bold mb-2" id="totalCalls">0</div>
                                <div class="small opacity-75">Total Calls Today</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3 mb-3">
                        <div class="card bg-success text-white rounded-4">
                            <div class="card-body text-center">
                                <div class="display-4 fw-bold mb-2" id="avgDuration">0m</div>
                                <div class="small opacity-75">Average Duration</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3 mb-3">
                        <div class="card bg-warning text-white rounded-4">
                            <div class="card-body text-center">
                                <div class="display-4 fw-bold mb-2" id="conversionRate">0%</div>
                                <div class="small opacity-75">Conversion Rate</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3 mb-3">
                        <div class="card bg-info text-white rounded-4">
                            <div class="card-body text-center">
                                <div class="display-4 fw-bold mb-2" id="followUps">0</div>
                                <div class="small opacity-75">Follow-ups Scheduled</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mb-3">
                    <i class="bi bi-clock-history me-2"></i>Recent Call History
                </h5>
                <div class="border rounded-4" style="max-height: 300px; overflow-y: auto;" id="callHistory">
                    <!-- Call history items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // TechFlow Knowledge Base
        const TECHFLOW_KNOWLEDGE = {
            services: {
                "web development": {
                    name: "Web Development",
                    description: "Custom web applications with modern technologies and responsive design",
                    priceRange: "$2,000 - $15,000",
                    timeline: "2-8 weeks"
                },
                "cloud solutions": {
                    name: "Cloud Solutions", 
                    description: "Scalable cloud infrastructure and migration services",
                    priceRange: "$5,000 - $25,000",
                    timeline: "3-12 weeks"
                },
                "ai integration": {
                    name: "AI Integration",
                    description: "Intelligent automation and AI-powered solutions",
                    priceRange: "$10,000 - $50,000",
                    timeline: "6-16 weeks"
                },
                "mobile apps": {
                    name: "Mobile Apps",
                    description: "Native and cross-platform mobile applications",
                    priceRange: "$8,000 - $30,000",
                    timeline: "8-20 weeks"
                },
                "cybersecurity": {
                    name: "Cybersecurity",
                    description: "Comprehensive security solutions for digital protection",
                    priceRange: "$3,000 - $20,000",
                    timeline: "2-10 weeks"
                },
                "data analytics": {
                    name: "Data Analytics", 
                    description: "Transform data into actionable business insights",
                    priceRange: "$5,000 - $35,000",
                    timeline: "4-14 weeks"
                }
            },
            
            packages: {
                starter: {
                    name: "Starter Package",
                    price: "$99 per month",
                    features: ["Basic website up to 5 pages", "Mobile responsive design", "SEO optimization", "Contact forms", "1 month support", "SSL certificate"]
                },
                professional: {
                    name: "Professional Package", 
                    price: "$299 per month",
                    popular: true,
                    features: ["Custom web application", "Database integration", "Admin dashboard", "API development", "Cloud deployment", "3 months support"]
                },
                enterprise: {
                    name: "Enterprise Package",
                    price: "$799 per month",
                    features: ["Full-scale application", "Microservices architecture", "AI/ML integration", "DevOps pipeline", "24/7 monitoring", "6 months support"]
                }
            },
            
            contact: {
                address: "123 Tech Boulevard, Karachi, Sindh 75500, Pakistan",
                phone: "+92 21 1234-5678",
                mobile: "+92 300 1234567",
                email: "info@techflowsolutions.com",
                whatsapp: "+923001234567",
                hours: "Monday to Friday: 9 AM to 6 PM, Saturday: 10 AM to 2 PM"
            }
        };

        // Global variables
        let callActive = false;
        let callStartTime = null;
        let conversationHistory = [];
        let messageCount = 0;
        let isListening = false;
        let isMuted = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;

        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                    document.getElementById('voiceAnimation').style.display = 'block';
                    document.getElementById('listenBtn').classList.add('active');
                };

                recognition.onend = function() {
                    document.getElementById('voiceStatus').textContent = 'Voice recognition stopped';
                    document.getElementById('voiceAnimation').style.display = 'none';
                    document.getElementById('listenBtn').classList.remove('active');
                    isListening = false;
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    
                    if (finalTranscript.trim()) {
                        processVoiceInput(finalTranscript.trim());
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    document.getElementById('voiceStatus').textContent = 'Voice recognition error: ' + event.error;
                };
            } else {
                document.getElementById('voiceStatus').textContent = 'Speech recognition not supported in this browser';
            }
        }

        // AI Response Generator
        function generateResponse(userInput) {
            const input = userInput.toLowerCase();
            
            // Greeting responses
            if (input.includes('hello') || input.includes('hi') || input.includes('good morning') || input.includes('good afternoon')) {
                return "Hello! Thank you for calling TechFlow Solutions. I'm your AI assistant. We're a leading IT company specializing in web development, cloud solutions, AI integration, mobile apps, cybersecurity, and data analytics. How can I help you today?";
            }
            
            // Service inquiries
            if (input.includes('service') || input.includes('what do you do')) {
                return "TechFlow Solutions offers six main services: Web Development for custom applications, Cloud Solutions for scalable infrastructure, AI Integration for intelligent automation, Mobile Apps for iOS and Android, Cybersecurity for digital protection, and Data Analytics for business insights. Which service interests you most?";
            }
            
            // Pricing inquiries
            if (input.includes('price') || input.includes('cost') || input.includes('package') || input.includes('budget')) {
                return "We offer three main packages: Starter at $99 per month for basic websites, Professional at $299 per month for custom applications, and Enterprise at $799 per month for full-scale solutions with AI integration. Custom pricing is also available based on your specific requirements. Which package sounds suitable for your needs?";
            }
            
            // Contact inquiries
            if (input.includes('contact') || input.includes('address') || input.includes('location')) {
                return `You can reach TechFlow Solutions at our office: ${TECHFLOW_KNOWLEDGE.contact.address}. Phone: ${TECHFLOW_KNOWLEDGE.contact.phone}, Mobile: ${TECHFLOW_KNOWLEDGE.contact.mobile}, Email: ${TECHFLOW_KNOWLEDGE.contact.email}. Our business hours are ${TECHFLOW_KNOWLEDGE.contact.hours}. Would you like me to schedule a consultation?`;
            }
            
            // Team inquiries
            if (input.includes('team') || input.includes('staff') || input.includes('who works')) {
                return "Our expert team includes Alex Rodriguez as CTO with 15+ years experience, Sarah Chen as Lead Developer specializing in React and Node.js, Michael Thompson as UI/UX Design Lead, Dr. Emily Watson as AI/ML Specialist with a PhD in Machine Learning, James Wilson as Cybersecurity Expert, and Lisa Park as Project Manager. We have over 50 team members total. Would you like to know more about any specific expertise area?";
            }
            
            // Consultation requests
            if (input.includes('consult') || input.includes('meeting') || input.includes('schedule') || input.includes('appointment')) {
                return "I'd be happy to schedule a free consultation! Our consultation includes project analysis, technology recommendations, timeline estimation, and team assignment discussion. Would you prefer an in-person meeting at our Karachi office, a video call, or phone consultation? What's your preferred date and time?";
            }
            
            // Technology inquiries
            if (input.includes('technology') || input.includes('tech') || input.includes('framework')) {
                return "TechFlow works with cutting-edge technologies including React, Node.js, Python for web development, React Native and Flutter for mobile apps, AWS and Azure for cloud solutions, and TensorFlow for AI integration. We recommend the best technology stack based on your project requirements. What type of project are you planning?";
            }
            
            // Default response
            return "I understand you're interested in TechFlow Solutions. I can help with information about our services, pricing packages, team capabilities, scheduling consultations, and technical guidance. Could you tell me more about what you're looking for or what type of project you have in mind?";
        }

        // Call management functions
        function startCall() {
            if (callActive) return;
            
            callActive = true;
            callStartTime = new Date();
            
            // Update UI elements
            const callStatus = document.getElementById('callStatus');
            const startBtn = document.getElementById('startCallBtn');
            const endBtn = document.getElementById('endCallBtn');
            const listenBtn = document.getElementById('listenBtn');
            const speakBtn = document.getElementById('speakBtn');
            const textInput = document.getElementById('textInput');
            const sendBtn = document.getElementById('sendBtn');
            const callStatusText = document.getElementById('callStatusText');
            
            callStatus.innerHTML = '<i class="bi bi-telephone-fill me-2"></i>CALL ACTIVE';
            callStatus.className = 'call-status status-active rounded-4 mb-4';
            
            startBtn.disabled = true;
            endBtn.disabled = false;
            listenBtn.disabled = false;
            speakBtn.disabled = false;
            textInput.disabled = false;
            sendBtn.disabled = false;
            
            if (callStatusText) {
                callStatusText.textContent = 'Active';
            }
            
            // Clear previous conversation
            document.getElementById('conversationArea').innerHTML = `
                <div class="d-none" id="typingIndicator">
                    <div class="d-flex align-items-center mb-3">
                        <div class="typing-dots me-2">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="text-muted">TechFlow Assistant is typing...</span>
                    </div>
                </div>
            `;
            conversationHistory = [];
            messageCount = 0;
            document.getElementById('messageCount').textContent = '0';
            
            // Add greeting message
            const greeting = generateResponse("hello");
            setTimeout(() => {
                addMessage(greeting, 'assistant');
                if (!isMuted) {
                    speakText(greeting);
                }
            }, 1000);
            
            // Start call timer
            startCallTimer();
            
            // Initialize speech recognition
            initSpeechRecognition();
            
            console.log('Call started successfully');
        }

        function endCall() {
            if (!callActive) return;
            
            callActive = false;
            
            // Update UI elements
            const callStatus = document.getElementById('callStatus');
            const startBtn = document.getElementById('startCallBtn');
            const endBtn = document.getElementById('endCallBtn');
            const listenBtn = document.getElementById('listenBtn');
            const speakBtn = document.getElementById('speakBtn');
            const textInput = document.getElementById('textInput');
            const sendBtn = document.getElementById('sendBtn');
            const callStatusText = document.getElementById('callStatusText');
            
            callStatus.innerHTML = '<i class="bi bi-telephone-x me-2"></i>CALL ENDED';
            callStatus.className = 'call-status status-inactive rounded-4 mb-4';
            
            startBtn.disabled = false;
            endBtn.disabled = true;
            listenBtn.disabled = true;
            speakBtn.disabled = true;
            textInput.disabled = true;
            sendBtn.disabled = true;
            
            if (callStatusText) {
                callStatusText.textContent = 'Inactive';
            }
            
            // Stop speech recognition properly
            if (recognition && isListening) {
                try {
                    recognition.stop();
                    isListening = false;
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
            
            // Stop any ongoing speech
            if (synthesis && synthesis.speaking) {
                synthesis.cancel();
            }
            
            // Reset voice animation
            const voiceAnimation = document.getElementById('voiceAnimation');
            if (voiceAnimation) {
                voiceAnimation.style.display = 'none';
            }
            
            // Reset mute button
            isMuted = false;
            const muteBtn = document.getElementById('muteBtn');
            if (muteBtn) {
                muteBtn.innerHTML = '<i class="bi bi-mic-mute me-2"></i>Mute';
                muteBtn.className = 'btn btn-gradient-warning rounded-pill px-4 py-2 fw-bold';
            }
            
            // Save call log if there was conversation
            if (messageCount > 0) {
                saveCallLog();
            }
            
            // Reset conversation state
            conversationHistory = [];
            messageCount = 0;
            const messageCountElement = document.getElementById('messageCount');
            if (messageCountElement) {
                messageCountElement.textContent = '0';
            }
            
            // Reset call duration
            const callDurationElement = document.getElementById('callDuration');
            if (callDurationElement) {
                callDurationElement.textContent = '00:00:00';
            }
            
            console.log('Call ended successfully');
        }

        function toggleMute() {
            if (!callActive) return;
            
            isMuted = !isMuted;
            const muteBtn = document.getElementById('muteBtn');
            
            if (isMuted) {
                muteBtn.innerHTML = '<i class="bi bi-mic me-2"></i>Unmute';
                muteBtn.className = 'btn btn-gradient-danger rounded-pill px-4 py-2 fw-bold';
                
                // Stop any ongoing speech
                if (synthesis.speaking) {
                    synthesis.cancel();
                }
            } else {
                muteBtn.innerHTML = '<i class="bi bi-mic-mute me-2"></i>Mute';
                muteBtn.className = 'btn btn-gradient-warning rounded-pill px-4 py-2 fw-bold';
            }
            
            console.log('Mute toggled:', isMuted);
        }

        // Speech functions
        function startListening() {
            if (!callActive) return;
            
            if (recognition && !isListening) {
                isListening = true;
                recognition.start();
            }
        }

        function processVoiceInput(transcript) {
            addMessage(transcript, 'user');
            
            // Generate AI response
            const response = generateResponse(transcript);
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(response, 'assistant');
                
                if (!isMuted) {
                    speakText(response);
                }
            }, 1000 + Math.random() * 2000);
        }

        function speakText(text) {
            if (isMuted || !callActive) return;
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.1;
            utterance.volume = 0.8;
            
            // Try to use a professional voice
            const voices = synthesis.getVoices();
            const preferredVoice = voices.find(voice => 
                voice.name.includes('Female') || 
                voice.name.includes('Zira') || 
                voice.name.includes('Google')
            );
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }
            
            synthesis.speak(utterance);
        }

        function speakResponse() {
            const lastMessage = conversationHistory[conversationHistory.length - 1];
            if (lastMessage && lastMessage.role === 'assistant') {
                speakText(lastMessage.content);
            }
        }

        // Message handling
        function addMessage(content, role) {
            const timestamp = new Date();
            const message = { role, content, timestamp };
            conversationHistory.push(message);
            messageCount++;
            
            const conversationArea = document.getElementById('conversationArea');
            const messageDiv = document.createElement('div');
            
            const timeString = timestamp.toLocaleTimeString();
            
            if (role === 'user') {
                messageDiv.className = 'card bg-primary text-white ms-auto mb-3';
                messageDiv.style.maxWidth = '80%';
                messageDiv.innerHTML = `
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-person-circle me-2"></i>
                            <strong>Caller</strong>
                        </div>
                        <div>${content}</div>
                        <small class="opacity-75 mt-2 d-block">${timeString}</small>
                    </div>
                `;
            } else {
                messageDiv.className = 'card bg-light me-auto mb-3';
                messageDiv.style.maxWidth = '80%';
                messageDiv.innerHTML = `
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-robot me-2 text-primary"></i>
                            <strong>TechFlow Assistant</strong>
                        </div>
                        <div>${content}</div>
                        <small class="text-muted mt-2 d-block">${timeString}</small>
                    </div>
                `;
            }
            
            // Add animation
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(20px)';
            conversationArea.appendChild(messageDiv);
            
            // Animate in
            setTimeout(() => {
                messageDiv.style.transition = 'all 0.3s ease-out';
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
            }, 10);
            
            conversationArea.scrollTop = conversationArea.scrollHeight;
            document.getElementById('messageCount').textContent = messageCount;
        }

        function sendTextMessage() {
            const textInput = document.getElementById('textInput');
            const message = textInput.value.trim();
            
            if (message && callActive) {
                addMessage(message, 'user');
                textInput.value = '';
                
                // Generate AI response
                const response = generateResponse(message);
                
                // Show typing indicator
                showTypingIndicator();
                
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(response, 'assistant');
                    
                    if (!isMuted) {
                        speakText(response);
                    }
                }, 1000 + Math.random() * 2000);
            }
        }

        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.classList.remove('d-none');
            const conversationArea = document.getElementById('conversationArea');
            conversationArea.scrollTop = conversationArea.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.classList.add('d-none');
        }

        // Quick response functions
        function quickResponse(type) {
            if (!callActive) return;
            
            let response = '';
            
            switch(type) {
                case 'services':
                    response = generateResponse('what services do you offer');
                    break;
                case 'pricing':
                    response = generateResponse('what are your prices');
                    break;
                case 'team':
                    response = generateResponse('tell me about your team');
                    break;
                case 'contact':
                    response = generateResponse('how can I contact you');
                    break;
                case 'consultation':
                    response = generateResponse('I want to schedule a consultation');
                    break;
            }
            
            if (response) {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(response, 'assistant');
                    if (!isMuted) {
                        speakText(response);
                    }
                }, 1000);
            }
        }

        function transferCall() {
            if (callActive) {
                const transferMessage = "I'm transferring you to one of our human specialists who can provide more detailed assistance. Please hold for a moment.";
                addMessage(transferMessage, 'assistant');
                speakText(transferMessage);
                
                setTimeout(() => {
                    alert('Call transferred to human agent. In a real implementation, this would connect to your phone system.');
                }, 2000);
            }
        }

        // Call timer
        function startCallTimer() {
            const timer = setInterval(() => {
                if (callActive && callStartTime) {
                    const duration = new Date() - callStartTime;
                    const hours = Math.floor(duration / 3600000);
                    const minutes = Math.floor((duration % 3600000) / 60000);
                    const seconds = Math.floor((duration % 60000) / 1000);
                    
                    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('callDuration').textContent = timeString;
                } else {
                    clearInterval(timer);
                }
            }, 1000);
        }

        // Call logging
        function saveCallLog() {
            const callerName = document.getElementById('callerName').value || 'Unknown';
            const callerPhone = document.getElementById('callerPhone').value || 'Unknown';
            const callerCompany = document.getElementById('callerCompany').value || 'N/A';
            const inquiryType = document.getElementById('inquiryType').value || 'General';
            
            const duration = callStartTime ? new Date() - callStartTime : 0;
            const durationString = new Date(duration).toISOString().substr(11, 8);
            
            const callLog = {
                id: Date.now(),
                callerName,
                callerPhone,
                callerCompany,
                inquiryType,
                duration: durationString,
                messageCount,
                timestamp: new Date(),
                summary: generateCallSummary()
            };
            
            // Save to localStorage (in real app, this would go to a database)
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            callLogs.unshift(callLog);
            localStorage.setItem('techflow_call_logs', JSON.stringify(callLogs.slice(0, 50))); // Keep last 50 calls
            
            updateCallHistory();
            updateMetrics();
        }

        function generateCallSummary() {
            const topics = [];
            conversationHistory.forEach(msg => {
                if (msg.role === 'user') {
                    const content = msg.content.toLowerCase();
                    if (content.includes('price') || content.includes('cost')) topics.push('Pricing');
                    if (content.includes('service')) topics.push('Services');
                    if (content.includes('team')) topics.push('Team');
                    if (content.includes('consult')) topics.push('Consultation');
                }
            });
            
            return `Discussed: ${topics.join(', ') || 'General inquiry'}. ${messageCount} messages exchanged.`;
        }

        function updateCallHistory() {
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            const historyContainer = document.getElementById('callHistory');
            
            historyContainer.innerHTML = '';
            
            if (callLogs.length === 0) {
                historyContainer.innerHTML = '<div class="p-4 text-center text-muted">No call history available</div>';
                return;
            }
            
            callLogs.slice(0, 10).forEach(log => {
                const callItem = document.createElement('div');
                callItem.className = 'border-bottom p-3';
                
                callItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-bold text-dark">
                                <i class="bi bi-person me-2"></i>${log.callerName}
                            </div>
                            <div class="text-muted small">
                                <i class="bi bi-tag me-1"></i>${log.inquiryType}
                            </div>
                            <div class="text-muted small">
                                <i class="bi bi-clock me-1"></i>${log.timestamp ? new Date(log.timestamp).toLocaleString() : 'Unknown time'}
                            </div>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success rounded-pill">
                                <i class="bi bi-check-circle me-1"></i>${log.duration}
                            </span>
                        </div>
                    </div>
                `;
                
                historyContainer.appendChild(callItem);
            });
        }

        function updateMetrics() {
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            const today = new Date().toDateString();
            
            // Today's calls
            const todayCalls = callLogs.filter(log => 
                log.timestamp && new Date(log.timestamp).toDateString() === today
            );
            document.getElementById('totalCalls').textContent = todayCalls.length;
            
            // Average duration
            if (todayCalls.length > 0) {
                const totalDuration = todayCalls.reduce((sum, log) => {
                    const parts = log.duration.split(':');
                    return sum + (parseInt(parts[0]) * 60 + parseInt(parts[1]));
                }, 0);
                const avgMinutes = Math.round(totalDuration / todayCalls.length);
                document.getElementById('avgDuration').textContent = `${avgMinutes}m`;
            }
            
            // Conversion rate (simulate)
            const conversionRate = Math.min(100, Math.round((todayCalls.length * 0.3) * 100) / 100);
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
            
            // Follow-ups (simulate)
            document.getElementById('followUps').textContent = Math.ceil(todayCalls.length * 0.6);
        }

        // Event listeners
        document.getElementById('textInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendTextMessage();
            }
        });

        // Voice synthesis initialization
        function initVoices() {
            if (synthesis.getVoices().length === 0) {
                synthesis.addEventListener('voiceschanged', initVoices);
            }
        }

        // Simulate incoming call (for demo)
        function simulateIncomingCall() {
            if (!callActive) {
                const callStatus = document.getElementById('callStatus');
                callStatus.innerHTML = '<i class="bi bi-telephone-inbound me-2"></i>INCOMING CALL';
                callStatus.className = 'call-status status-waiting rounded-4 mb-4';
                
                setTimeout(() => {
                    if (!callActive) {
                        callStatus.innerHTML = '<i class="bi bi-telephone me-2"></i>WAITING FOR CALLS';
                        callStatus.className = 'call-status status-inactive rounded-4 mb-4';
                    }
                }, 10000);
            }
        }

        // Auto-simulate incoming calls for demo
        setInterval(simulateIncomingCall, 30000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initVoices();
            updateCallHistory();
            updateMetrics();
            
            // Demo data for initial display
            setTimeout(() => {
                if (localStorage.getItem('techflow_call_logs') === null) {
                    const demoLogs = [
                        {
                            id: 1,
                            callerName: 'John Smith',
                            callerPhone: '+92 300 1111111',
                            inquiryType: 'Web Development',
                            duration: '00:05:23',
                            timestamp: new Date(Date.now() - 3600000),
                            summary: 'Discussed web development project for e-commerce site'
                        },
                        {
                            id: 2,
                            callerName: 'Sarah Ahmed',
                            callerPhone: '+92 300 2222222',
                            inquiryType: 'Cloud Solutions',
                            duration: '00:08:15',
                            timestamp: new Date(Date.now() - 7200000),
                            summary: 'Inquired about cloud migration services'
                        }
                    ];
                    localStorage.setItem('techflow_call_logs', JSON.stringify(demoLogs));
                    updateCallHistory();
                    updateMetrics();
                }
            }, 1000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (!callActive) startCall();
                        break;
                    case 'e':
                        e.preventDefault();
                        if (callActive) endCall();
                        break;
                    case 'm':
                        e.preventDefault();
                        toggleMute();
                        break;
                    case 'l':
                        e.preventDefault();
                        startListening();
                        break;
                }
            }
        });
    </script>
</body>
</html>
