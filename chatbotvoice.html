<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow Calling Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .main-interface {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .call-interface {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .call-status {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .call-status.active {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            animation: pulse 2s infinite;
        }

        .call-status.inactive {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .call-status.waiting {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .call-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .control-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .end-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .mute-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .voice-interface {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .voice-btn {
            width: 80px;
            height: 80px;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .listen-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .speak-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .voice-btn.active {
            animation: pulse 1.5s infinite;
        }

        .conversation-area {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 15px;
            max-width: 80%;
            animation: messageSlide 0.3s ease-out;
        }

        .message.user {
            background: #007bff;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message.assistant {
            background: white;
            border: 2px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }

        .text-input-area {
            margin-top: 1rem;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .sidebar {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .caller-info {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .quick-actions {
            margin-top: 2rem;
        }

        .quick-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 0.5rem;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .analytics-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
        }

        .metric-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .call-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .call-item {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .call-item:hover {
            background: #f8f9fa;
        }

        .status-indicator {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .voice-animation {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .voice-circle {
            width: 100%;
            height: 100%;
            border: 3px solid #667eea;
            border-radius: 50%;
            position: absolute;
            animation: voicePulse 1.5s infinite;
        }

        .voice-circle:nth-child(2) {
            animation-delay: 0.5s;
        }

        .voice-circle:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes voicePulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 40px rgba(102, 126, 234, 0.8);
            }
        }

        .typing-indicator {
            display: none;
            padding: 1rem;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            margin-bottom: 1rem;
            max-width: 80%;
        }

        .typing-indicator.active {
            display: block;
            animation: messageSlide 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typingDots 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        @media (max-width: 768px) {
            .main-interface {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .call-controls {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .control-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìû TechFlow Calling Assistant</h1>
            <p>AI-Powered Customer Support & Sales Assistant</p>
        </div>

        <div class="main-interface">
            <div class="call-interface">
                <div class="call-status inactive" id="callStatus">
                    üìû WAITING FOR CALLS
                </div>

                <div class="call-controls">
                    <button class="control-btn start-btn" id="startCallBtn" onclick="startCall()">
                        üìû Start Call
                    </button>
                    <button class="control-btn end-btn" id="endCallBtn" onclick="endCall()" disabled>
                        üìû End Call
                    </button>
                    <button class="control-btn mute-btn" id="muteBtn" onclick="toggleMute()">
                        üîá Mute
                    </button>
                </div>

                <div class="voice-interface">
                    <h3>üéôÔ∏è Voice Interface</h3>
                    <div class="voice-animation" id="voiceAnimation" style="display: none;">
                        <div class="voice-circle"></div>
                        <div class="voice-circle"></div>
                        <div class="voice-circle"></div>
                    </div>
                    
                    <div class="voice-controls">
                        <button class="voice-btn listen-btn" id="listenBtn" onclick="startListening()" disabled>
                            üé§
                        </button>
                        <button class="voice-btn speak-btn" id="speakBtn" onclick="speakResponse()" disabled>
                            üîä
                        </button>
                    </div>
                    
                    <div id="voiceStatus" style="text-align: center; margin-top: 1rem;">
                        Voice recognition ready
                    </div>
                </div>

                <div class="conversation-area" id="conversationArea">
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span style="margin-left: 10px;">TechFlow Assistant is typing...</span>
                    </div>
                </div>

                <div class="text-input-area">
                    <input type="text" class="text-input" id="textInput" placeholder="Type message for testing..." disabled>
                    <button class="send-btn" id="sendBtn" onclick="sendTextMessage()" disabled>Send Message</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="caller-info">
                    <h3>üë§ Caller Information</h3>
                    <div class="form-group">
                        <label for="callerName">Caller Name</label>
                        <input type="text" id="callerName" placeholder="Enter caller name">
                    </div>
                    <div class="form-group">
                        <label for="callerPhone">Phone Number</label>
                        <input type="tel" id="callerPhone" placeholder="+92 300 1234567">
                    </div>
                    <div class="form-group">
                        <label for="callerCompany">Company</label>
                        <input type="text" id="callerCompany" placeholder="Company name">
                    </div>
                    <div class="form-group">
                        <label for="inquiryType">Inquiry Type</label>
                        <select id="inquiryType">
                            <option value="">Select inquiry type</option>
                            <option value="web-development">Web Development</option>
                            <option value="cloud-solutions">Cloud Solutions</option>
                            <option value="ai-integration">AI Integration</option>
                            <option value="mobile-apps">Mobile Apps</option>
                            <option value="cybersecurity">Cybersecurity</option>
                            <option value="data-analytics">Data Analytics</option>
                            <option value="pricing">Pricing Information</option>
                            <option value="support">Technical Support</option>
                        </select>
                    </div>
                </div>



                <div style="margin-top: 2rem;">
                    <h3>üìä Call Metrics</h3>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                        <div>Duration: <span id="callDuration">00:00:00</span></div>
                        <div>Messages: <span id="messageCount">0</span></div>
                        <div>Status: <span id="callStatusText">Inactive</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="analytics-section">
            <h2>üìä Call Analytics Dashboard</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-number" id="totalCalls">0</div>
                    <div class="metric-label">Total Calls Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="avgDuration">0m</div>
                    <div class="metric-label">Average Duration</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="conversionRate">0%</div>
                    <div class="metric-label">Conversion Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="followUps">0</div>
                    <div class="metric-label">Follow-ups Scheduled</div>
                </div>
            </div>

            <h3>üìã Recent Call History</h3>
            <div class="call-history" id="callHistory">
                <!-- Call history items will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // TechFlow Knowledge Base
        const TECHFLOW_KNOWLEDGE = {
            services: {
                "web development": {
                    name: "Web Development",
                    description: "Custom web applications with modern technologies and responsive design",
                    priceRange: "$2,000 - $15,000",
                    timeline: "2-8 weeks"
                },
                "cloud solutions": {
                    name: "Cloud Solutions", 
                    description: "Scalable cloud infrastructure and migration services",
                    priceRange: "$5,000 - $25,000",
                    timeline: "3-12 weeks"
                },
                "ai integration": {
                    name: "AI Integration",
                    description: "Intelligent automation and AI-powered solutions",
                    priceRange: "$10,000 - $50,000",
                    timeline: "6-16 weeks"
                },
                "mobile apps": {
                    name: "Mobile Apps",
                    description: "Native and cross-platform mobile applications",
                    priceRange: "$8,000 - $30,000",
                    timeline: "8-20 weeks"
                },
                "cybersecurity": {
                    name: "Cybersecurity",
                    description: "Comprehensive security solutions for digital protection",
                    priceRange: "$3,000 - $20,000",
                    timeline: "2-10 weeks"
                },
                "data analytics": {
                    name: "Data Analytics", 
                    description: "Transform data into actionable business insights",
                    priceRange: "$5,000 - $35,000",
                    timeline: "4-14 weeks"
                }
            },
            
            packages: {
                starter: {
                    name: "Starter Package",
                    price: "$99 per month",
                    features: ["Basic website up to 5 pages", "Mobile responsive design", "SEO optimization", "Contact forms", "1 month support", "SSL certificate"]
                },
                professional: {
                    name: "Professional Package", 
                    price: "$299 per month",
                    popular: true,
                    features: ["Custom web application", "Database integration", "Admin dashboard", "API development", "Cloud deployment", "3 months support"]
                },
                enterprise: {
                    name: "Enterprise Package",
                    price: "$799 per month",
                    features: ["Full-scale application", "Microservices architecture", "AI/ML integration", "DevOps pipeline", "24/7 monitoring", "6 months support"]
                }
            },
            
            contact: {
                address: "123 Tech Boulevard, Karachi, Sindh 75500, Pakistan",
                phone: "+92 21 1234-5678",
                mobile: "+92 300 1234567",
                email: "info@techflowsolutions.com",
                whatsapp: "+923001234567",
                hours: "Monday to Friday: 9 AM to 6 PM, Saturday: 10 AM to 2 PM"
            }
        };

        // Global variables
        let callActive = false;
        let callStartTime = null;
        let conversationHistory = [];
        let messageCount = 0;
        let isListening = false;
        let isMuted = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;

        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                    document.getElementById('voiceAnimation').style.display = 'block';
                    document.getElementById('listenBtn').classList.add('active');
                };

                recognition.onend = function() {
                    document.getElementById('voiceStatus').textContent = 'Voice recognition stopped';
                    document.getElementById('voiceAnimation').style.display = 'none';
                    document.getElementById('listenBtn').classList.remove('active');
                    isListening = false;
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    
                    if (finalTranscript.trim()) {
                        processVoiceInput(finalTranscript.trim());
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    document.getElementById('voiceStatus').textContent = 'Voice recognition error: ' + event.error;
                };
            } else {
                document.getElementById('voiceStatus').textContent = 'Speech recognition not supported in this browser';
            }
        }

        // AI Response Generator
        function generateResponse(userInput) {
            const input = userInput.toLowerCase();
            
            // Greeting responses
            if (input.includes('hello') || input.includes('hi') || input.includes('good morning') || input.includes('good afternoon')) {
                return "Hello! Thank you for calling TechFlow Solutions. I'm your AI assistant. We're a leading IT company specializing in web development, cloud solutions, AI integration, mobile apps, cybersecurity, and data analytics. How can I help you today?";
            }
            
            // Service inquiries
            if (input.includes('service') || input.includes('what do you do')) {
                return "TechFlow Solutions offers six main services: Web Development for custom applications, Cloud Solutions for scalable infrastructure, AI Integration for intelligent automation, Mobile Apps for iOS and Android, Cybersecurity for digital protection, and Data Analytics for business insights. Which service interests you most?";
            }
            
            // Pricing inquiries
            if (input.includes('price') || input.includes('cost') || input.includes('package') || input.includes('budget')) {
                return "We offer three main packages: Starter at $99 per month for basic websites, Professional at $299 per month for custom applications, and Enterprise at $799 per month for full-scale solutions with AI integration. Custom pricing is also available based on your specific requirements. Which package sounds suitable for your needs?";
            }
            
            // Contact inquiries
            if (input.includes('contact') || input.includes('address') || input.includes('location')) {
                return `You can reach TechFlow Solutions at our office: ${TECHFLOW_KNOWLEDGE.contact.address}. Phone: ${TECHFLOW_KNOWLEDGE.contact.phone}, Mobile: ${TECHFLOW_KNOWLEDGE.contact.mobile}, Email: ${TECHFLOW_KNOWLEDGE.contact.email}. Our business hours are ${TECHFLOW_KNOWLEDGE.contact.hours}. Would you like me to schedule a consultation?`;
            }
            
            // Team inquiries
            if (input.includes('team') || input.includes('staff') || input.includes('who works')) {
                return "Our expert team includes Alex Rodriguez as CTO with 15+ years experience, Sarah Chen as Lead Developer specializing in React and Node.js, Michael Thompson as UI/UX Design Lead, Dr. Emily Watson as AI/ML Specialist with a PhD in Machine Learning, James Wilson as Cybersecurity Expert, and Lisa Park as Project Manager. We have over 50 team members total. Would you like to know more about any specific expertise area?";
            }
            
            // Consultation requests
            if (input.includes('consult') || input.includes('meeting') || input.includes('schedule') || input.includes('appointment')) {
                return "I'd be happy to schedule a free consultation! Our consultation includes project analysis, technology recommendations, timeline estimation, and team assignment discussion. Would you prefer an in-person meeting at our Karachi office, a video call, or phone consultation? What's your preferred date and time?";
            }
            
            // Technology inquiries
            if (input.includes('technology') || input.includes('tech') || input.includes('framework')) {
                return "TechFlow works with cutting-edge technologies including React, Node.js, Python for web development, React Native and Flutter for mobile apps, AWS and Azure for cloud solutions, and TensorFlow for AI integration. We recommend the best technology stack based on your project requirements. What type of project are you planning?";
            }
            
            // Default response
            return "I understand you're interested in TechFlow Solutions. I can help with information about our services, pricing packages, team capabilities, scheduling consultations, and technical guidance. Could you tell me more about what you're looking for or what type of project you have in mind?";
        }

        // Call management functions
        function startCall() {
            if (callActive) return;
            
            callActive = true;
            callStartTime = new Date();
            
            // Update UI elements
            const callStatus = document.getElementById('callStatus');
            const startBtn = document.getElementById('startCallBtn');
            const endBtn = document.getElementById('endCallBtn');
            const listenBtn = document.getElementById('listenBtn');
            const speakBtn = document.getElementById('speakBtn');
            const textInput = document.getElementById('textInput');
            const sendBtn = document.getElementById('sendBtn');
            const callStatusText = document.getElementById('callStatusText');
            
            callStatus.textContent = 'üìû CALL ACTIVE';
            callStatus.className = 'call-status active';
            
            startBtn.disabled = true;
            endBtn.disabled = false;
            listenBtn.disabled = false;
            speakBtn.disabled = false;
            textInput.disabled = false;
            sendBtn.disabled = false;
            
            if (callStatusText) {
                callStatusText.textContent = 'Active';
            }
            
            // Clear previous conversation
            document.getElementById('conversationArea').innerHTML = '<div class="typing-indicator" id="typingIndicator"><div class="typing-dots"><span></span><span></span><span></span></div><span style="margin-left: 10px;">TechFlow Assistant is typing...</span></div>';
            conversationHistory = [];
            messageCount = 0;
            document.getElementById('messageCount').textContent = '0';
            
            // Add greeting message
            const greeting = generateResponse("hello");
            setTimeout(() => {
                addMessage(greeting, 'assistant');
                if (!isMuted) {
                    speakText(greeting);
                }
            }, 1000);
            
            // Start call timer
            startCallTimer();
            
            // Initialize speech recognition
            initSpeechRecognition();
            
            console.log('Call started successfully');
        }

        function endCall() {
            if (!callActive) return;
            
            callActive = false;
            
            // Update UI elements
            const callStatus = document.getElementById('callStatus');
            const startBtn = document.getElementById('startCallBtn');
            const endBtn = document.getElementById('endCallBtn');
            const listenBtn = document.getElementById('listenBtn');
            const speakBtn = document.getElementById('speakBtn');
            const textInput = document.getElementById('textInput');
            const sendBtn = document.getElementById('sendBtn');
            const callStatusText = document.getElementById('callStatusText');
            
            callStatus.textContent = 'üìû CALL ENDED';
            callStatus.className = 'call-status inactive';
            
            startBtn.disabled = false;
            endBtn.disabled = true;
            listenBtn.disabled = true;
            speakBtn.disabled = true;
            textInput.disabled = true;
            sendBtn.disabled = true;
            
            if (callStatusText) {
                callStatusText.textContent = 'Inactive';
            }
            
            // Stop speech recognition properly
            if (recognition && isListening) {
                try {
                    recognition.stop();
                    isListening = false;
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
            
            // Stop any ongoing speech
            if (synthesis && synthesis.speaking) {
                synthesis.cancel();
            }
            
            // Reset voice animation
            const voiceAnimation = document.getElementById('voiceAnimation');
            if (voiceAnimation) {
                voiceAnimation.style.display = 'none';
            }
            
            // Reset mute button
            isMuted = false;
            const muteBtn = document.getElementById('muteBtn');
            if (muteBtn) {
                muteBtn.innerHTML = 'üîá Mute';
                muteBtn.style.background = 'linear-gradient(45deg, #ff9800, #f57c00)';
                muteBtn.style.color = 'white';
            }
            
            // Save call log if there was conversation
            if (messageCount > 0) {
                saveCallLog();
            }
            
            // Reset conversation state
            conversationHistory = [];
            messageCount = 0;
            const messageCountElement = document.getElementById('messageCount');
            if (messageCountElement) {
                messageCountElement.textContent = '0';
            }
            
            // Reset call duration
            const callDurationElement = document.getElementById('callDuration');
            if (callDurationElement) {
                callDurationElement.textContent = '00:00:00';
            }
            
            console.log('Call ended successfully');
        }

        function toggleMute() {
            if (!callActive) return;
            
            isMuted = !isMuted;
            const muteBtn = document.getElementById('muteBtn');
            
            if (isMuted) {
                muteBtn.innerHTML = 'üîä Unmute';
                muteBtn.style.background = 'linear-gradient(45deg, #f44336, #d32f2f)';
                muteBtn.style.color = 'white';
                
                // Stop any ongoing speech
                if (synthesis.speaking) {
                    synthesis.cancel();
                }
            } else {
                muteBtn.innerHTML = 'üîá Mute';
                muteBtn.style.background = 'linear-gradient(45deg, #ff9800, #f57c00)';
                muteBtn.style.color = 'white';
            }
            
            console.log('Mute toggled:', isMuted);
        }

        // Speech functions
        function startListening() {
            if (!callActive) return;
            
            if (recognition && !isListening) {
                isListening = true;
                recognition.start();
            }
        }

        function processVoiceInput(transcript) {
            addMessage(transcript, 'user');
            
            // Generate AI response
            const response = generateResponse(transcript);
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(response, 'assistant');
                
                if (!isMuted) {
                    speakText(response);
                }
            }, 1000 + Math.random() * 2000);
        }

        function speakText(text) {
            if (isMuted || !callActive) return;
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.1;
            utterance.volume = 0.8;
            
            // Try to use a professional voice
            const voices = synthesis.getVoices();
            const preferredVoice = voices.find(voice => 
                voice.name.includes('Female') || 
                voice.name.includes('Zira') || 
                voice.name.includes('Google')
            );
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }
            
            synthesis.speak(utterance);
        }

        function speakResponse() {
            const lastMessage = conversationHistory[conversationHistory.length - 1];
            if (lastMessage && lastMessage.role === 'assistant') {
                speakText(lastMessage.content);
            }
        }

        // Message handling
        function addMessage(content, role) {
            const timestamp = new Date();
            const message = { role, content, timestamp };
            conversationHistory.push(message);
            messageCount++;
            
            const conversationArea = document.getElementById('conversationArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const timeString = timestamp.toLocaleTimeString();
            messageDiv.innerHTML = `
                <div><strong>${role === 'user' ? 'Caller' : 'TechFlow Assistant'}:</strong></div>
                <div>${content}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            conversationArea.appendChild(messageDiv);
            conversationArea.scrollTop = conversationArea.scrollHeight;
            
            document.getElementById('messageCount').textContent = messageCount;
        }

        function sendTextMessage() {
            const textInput = document.getElementById('textInput');
            const message = textInput.value.trim();
            
            if (message && callActive) {
                processVoiceInput(message);
                textInput.value = '';
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('active');
            const conversationArea = document.getElementById('conversationArea');
            conversationArea.scrollTop = conversationArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('active');
        }

        // Quick response functions
        function quickResponse(type) {
            if (!callActive) return;
            
            let response = '';
            
            switch(type) {
                case 'services':
                    response = generateResponse('what services do you offer');
                    break;
                case 'pricing':
                    response = generateResponse('what are your prices');
                    break;
                case 'team':
                    response = generateResponse('tell me about your team');
                    break;
                case 'contact':
                    response = generateResponse('how can I contact you');
                    break;
                case 'consultation':
                    response = generateResponse('I want to schedule a consultation');
                    break;
            }
            
            if (response) {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(response, 'assistant');
                    if (!isMuted) {
                        speakText(response);
                    }
                }, 1000);
            }
        }

        function transferCall() {
            if (callActive) {
                const transferMessage = "I'm transferring you to one of our human specialists who can provide more detailed assistance. Please hold for a moment.";
                addMessage(transferMessage, 'assistant');
                speakText(transferMessage);
                
                setTimeout(() => {
                    alert('Call transferred to human agent. In a real implementation, this would connect to your phone system.');
                }, 2000);
            }
        }

        // Call timer
        function startCallTimer() {
            const timer = setInterval(() => {
                if (callActive && callStartTime) {
                    const duration = new Date() - callStartTime;
                    const hours = Math.floor(duration / 3600000);
                    const minutes = Math.floor((duration % 3600000) / 60000);
                    const seconds = Math.floor((duration % 60000) / 1000);
                    
                    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('callDuration').textContent = timeString;
                } else {
                    clearInterval(timer);
                }
            }, 1000);
        }

        // Call logging
        function saveCallLog() {
            const callerName = document.getElementById('callerName').value || 'Unknown';
            const callerPhone = document.getElementById('callerPhone').value || 'Unknown';
            const callerCompany = document.getElementById('callerCompany').value || 'N/A';
            const inquiryType = document.getElementById('inquiryType').value || 'General';
            
            const duration = callStartTime ? new Date() - callStartTime : 0;
            const durationString = new Date(duration).toISOString().substr(11, 8);
            
            const callLog = {
                id: Date.now(),
                callerName,
                callerPhone,
                callerCompany,
                inquiryType,
                duration: durationString,
                messageCount,
                timestamp: new Date(),
                summary: generateCallSummary()
            };
            
            // Save to localStorage (in real app, this would go to a database)
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            callLogs.unshift(callLog);
            localStorage.setItem('techflow_call_logs', JSON.stringify(callLogs.slice(0, 50))); // Keep last 50 calls
            
            updateCallHistory();
            updateMetrics();
        }

        function generateCallSummary() {
            const topics = [];
            conversationHistory.forEach(msg => {
                if (msg.role === 'user') {
                    const content = msg.content.toLowerCase();
                    if (content.includes('price') || content.includes('cost')) topics.push('Pricing');
                    if (content.includes('service')) topics.push('Services');
                    if (content.includes('team')) topics.push('Team');
                    if (content.includes('consult')) topics.push('Consultation');
                }
            });
            
            return `Discussed: ${topics.join(', ') || 'General inquiry'}. ${messageCount} messages exchanged.`;
        }

        function updateCallHistory() {
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            const historyContainer = document.getElementById('callHistory');
            
            historyContainer.innerHTML = '';
            
            callLogs.slice(0, 10).forEach(log => {
                const callItem = document.createElement('div');
                callItem.className = 'call-item';
                
                callItem.innerHTML = `
                    <div>
                        <strong>${log.callerName}</strong> - ${log.inquiryType}<br>
                        <small>${log.timestamp ? new Date(log.timestamp).toLocaleString() : 'Unknown time'}</small>
                    </div>
                    <div>
                        <div class="status-indicator status-completed">${log.duration}</div>
                    </div>
                `;
                
                historyContainer.appendChild(callItem);
            });
        }

        function updateMetrics() {
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            const today = new Date().toDateString();
            
            // Today's calls
            const todayCalls = callLogs.filter(log => 
                log.timestamp && new Date(log.timestamp).toDateString() === today
            );
            document.getElementById('totalCalls').textContent = todayCalls.length;
            
            // Average duration
            if (todayCalls.length > 0) {
                const totalDuration = todayCalls.reduce((sum, log) => {
                    const parts = log.duration.split(':');
                    return sum + (parseInt(parts[0]) * 60 + parseInt(parts[1]));
                }, 0);
                const avgMinutes = Math.round(totalDuration / todayCalls.length);
                document.getElementById('avgDuration').textContent = `${avgMinutes}m`;
            }
            
            // Conversion rate (simulate)
            const conversionRate = Math.min(100, Math.round((todayCalls.length * 0.3) * 100) / 100);
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
            
            // Follow-ups (simulate)
            document.getElementById('followUps').textContent = Math.ceil(todayCalls.length * 0.6);
        }

        // Event listeners
        document.getElementById('textInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendTextMessage();
            }
        });

        // Voice synthesis initialization
        function initVoices() {
            if (synthesis.getVoices().length === 0) {
                synthesis.addEventListener('voiceschanged', initVoices);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initVoices();
            updateCallHistory();
            updateMetrics();
            
            // Demo data for initial display
            setTimeout(() => {
                if (localStorage.getItem('techflow_call_logs') === null) {
                    const demoLogs = [
                        {
                            id: 1,
                            callerName: 'John Smith',
                            callerPhone: '+92 300 1111111',
                            inquiryType: 'Web Development',
                            duration: '00:05:23',
                            timestamp: new Date(Date.now() - 3600000),
                            summary: 'Discussed web development project for e-commerce site'
                        },
                        {
                            id: 2,
                            callerName: 'Sarah Ahmed',
                            callerPhone: '+92 300 2222222',
                            inquiryType: 'Cloud Solutions',
                            duration: '00:08:15',
                            timestamp: new Date(Date.now() - 7200000),
                            summary: 'Inquired about cloud migration services'
                        }
                    ];
                    localStorage.setItem('techflow_call_logs', JSON.stringify(demoLogs));
                    updateCallHistory();
                    updateMetrics();
                }
            }, 1000);
        });

        // Simulate incoming call (for demo)
        function simulateIncomingCall() {
            if (!callActive) {
                document.getElementById('callStatus').textContent = 'üìû INCOMING CALL';
                document.getElementById('callStatus').className = 'call-status waiting';
                
                setTimeout(() => {
                    if (!callActive) {
                        document.getElementById('callStatus').textContent = 'üìû WAITING FOR CALLS';
                        document.getElementById('callStatus').className = 'call-status inactive';
                    }
                }, 10000);
            }
        }

        // Auto-simulate incoming calls for demo
        setInterval(simulateIncomingCall, 30000);

        // Additional helper functions
        function exportCallData() {
            const callLogs = JSON.parse(localStorage.getItem('techflow_call_logs') || '[]');
            const dataStr = JSON.stringify(callLogs, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `techflow_calls_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function clearCallHistory() {
            if (confirm('Are you sure you want to clear all call history?')) {
                localStorage.removeItem('techflow_call_logs');
                updateCallHistory();
                updateMetrics();
            }
        }

        // Advanced AI responses with context awareness
        function generateContextualResponse(userInput, callerInfo) {
            const input = userInput.toLowerCase();
            const callerName = callerInfo.name || 'there';
            const inquiryType = callerInfo.inquiryType;
            
            // Personalized responses based on caller info
            if (inquiryType && input.includes('tell me more')) {
                switch(inquiryType) {
                    case 'web-development':
                        return `${callerName}, for web development, we create custom applications using React, Node.js, and modern frameworks. Our web development service ranges from ${TECHFLOW_KNOWLEDGE.services['web development'].priceRange} with a typical timeline of ${TECHFLOW_KNOWLEDGE.services['web development'].timeline}. Would you like to discuss your specific requirements?`;
                    case 'cloud-solutions':
                        return `${callerName}, our cloud solutions help businesses migrate to AWS, Azure, or Google Cloud. We handle everything from architecture design to migration and ongoing support. Investment typically ranges ${TECHFLOW_KNOWLEDGE.services['cloud solutions'].priceRange}. What's your current infrastructure setup?`;
                    case 'ai-integration':
                        return `${callerName}, we integrate AI and machine learning into existing business processes. Dr. Emily Watson, our AI specialist, leads projects involving automation, data analysis, and intelligent systems. Projects range ${TECHFLOW_KNOWLEDGE.services['ai integration'].priceRange}. What business processes are you looking to enhance?`;
                    default:
                        return generateResponse(userInput);
                }
            }
            
            return generateResponse(userInput);
        }

        // Enhanced message processing
        function processMessage(message, source = 'text') {
            const callerInfo = {
                name: document.getElementById('callerName').value,
                phone: document.getElementById('callerPhone').value,
                company: document.getElementById('callerCompany').value,
                inquiryType: document.getElementById('inquiryType').value
            };
            
            const response = generateContextualResponse(message, callerInfo);
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(response, 'assistant');
                
                if (!isMuted && source === 'voice') {
                    speakText(response);
                }
            }, 800 + Math.random() * 1500);
        }

        // Real-time call quality monitoring
        function monitorCallQuality() {
            if (callActive) {
                // Simulate call quality metrics
                const quality = Math.random() > 0.1 ? 'Good' : 'Poor';
                const latency = Math.floor(Math.random() * 200) + 50; // 50-250ms
                
                // In a real implementation, you would monitor actual audio quality
                console.log(`Call Quality: ${quality}, Latency: ${latency}ms`);
            }
        }

        // Start call quality monitoring
        setInterval(monitorCallQuality, 5000);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (!callActive) startCall();
                        break;
                    case 'e':
                        e.preventDefault();
                        if (callActive) endCall();
                        break;
                    case 'm':
                        e.preventDefault();
                        toggleMute();
                        break;
                    case 'l':
                        e.preventDefault();
                        startListening();
                        break;
                }
            }
        });

        // Service worker for offline functionality (optional)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(function(registration) {
                console.log('Service Worker registered successfully');
            }).catch(function(error) {
                console.log('Service Worker registration failed');
            });
        }

        // Web Audio API for advanced audio processing
        let audioContext;
        let mediaStream;

        async function initAudioContext() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                const source = audioContext.createMediaStreamSource(mediaStream);
                const analyser = audioContext.createAnalyser();
                source.connect(analyser);
                
                // Audio level monitoring
                monitorAudioLevel(analyser);
            } catch (error) {
                console.error('Error initializing audio:', error);
                document.getElementById('voiceStatus').textContent = 'Microphone access denied';
            }
        }

        function monitorAudioLevel(analyser) {
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            
            function updateLevel() {
                if (callActive && isListening) {
                    analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    
                    // Visual feedback for audio level
                    const voiceAnimation = document.getElementById('voiceAnimation');
                    if (average > 20) {
                        voiceAnimation.style.opacity = Math.min(1, average / 100);
                    }
                }
                requestAnimationFrame(updateLevel);
            }
            updateLevel();
        }

        // Initialize audio when user first interacts
        document.addEventListener('click', initAudioContext, { once: true });

        // Advanced call analytics
        function generateCallReport() {
            const callerName = document.getElementById('callerName').value || 'Unknown';
            const callerPhone = document.getElementById('callerPhone').value || 'Unknown';
            const inquiryType = document.getElementById('inquiryType').value || 'General';
            
            const reportData = {
                caller: callerName,
                phone: callerPhone,
                inquiry: inquiryType,
                duration: document.getElementById('callDuration').textContent,
                messages: messageCount,
                timestamp: new Date().toLocaleString(),
                summary: generateCallSummary(),
                nextSteps: determineNextSteps()
            };
            
            // Create downloadable report
            const reportText = `
TechFlow Solutions - Call Report
================================
Date: ${reportData.timestamp}
Caller: ${reportData.caller}
Phone: ${reportData.phone}
Company: ${document.getElementById('callerCompany').value || 'N/A'}
Inquiry Type: ${reportData.inquiry}
Call Duration: ${reportData.duration}
Messages Exchanged: ${reportData.messages}

Summary:
${reportData.summary}

Recommended Next Steps:
${reportData.nextSteps}

Generated by TechFlow AI Assistant
            `;
            
            const blob = new Blob([reportText], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `call_report_${Date.now()}.txt`;
            link.click();
        }

        function determineNextSteps() {
            const inquiryType = document.getElementById('inquiryType').value;
            const messageCount = conversationHistory.length;
            
            if (messageCount > 10) {
                return "High engagement - Schedule detailed consultation with technical team";
            } else if (inquiryType && inquiryType !== '') {
                return `Send follow-up email with ${inquiryType} portfolio and case studies`;
            } else {
                return "Send general company brochure and schedule follow-up call";
            }
        }

        // Integration with TechFlow website
        function redirectToWebsite() {
            window.open('https://techflowsolutions.com', '_blank');
        }

        function openWhatsAppChat() {
            const message = "Hi TechFlow! I just finished a call with your AI assistant and would like to continue our conversation.";
            const whatsappUrl = `https://wa.me/923001234567?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Add integration buttons to sidebar
        setTimeout(() => {
            const sidebar = document.querySelector('.sidebar');
            // Just update metrics instead of adding integration buttons
            updateMetrics();
        }, 1000);
    </script>
</body>
</html>
